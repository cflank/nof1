# NOF1-TRACKER 详细使用说明

## 📋 目录
1. [项目概述](#项目概述)
2. [安装与配置](#安装与配置)
3. [环境变量配置](#环境变量配置)
4. [命令使用指南](#命令使用指南)
5. [高级功能](#高级功能)
6. [监控与维护](#监控与维护)
7. [安全注意事项](#安全注意事项)
8. [故障排除](#故障排除)
9. [最佳实践](#最佳实践)

---

## 🎯 项目概述

**nof1-tracker** 是一个专业的加密货币自动化交易跟单系统，可以跟踪nof1.ai平台上AI代理的交易信号，并自动在币安期货平台执行相应的交易操作。

### 核心功能
- 🤖 **AI代理跟单** - 实时跟踪AI交易信号
- 📊 **盈亏分析** - 详细的交易统计和分析
- ⚠️ **风险管理** - 价格容忍度和风险控制
- 🔄 **自动交易** - 全自动化交易执行
- 📈 **实时监控** - 24/7运行监控

---

## 🚀 安装与配置

### 系统要求
- **操作系统**: Ubuntu 18.04+ 或其他Linux发行版
- **Node.js**: 18.0.0 或更高版本
- **内存**: 最少1GB，推荐2GB+
- **存储**: 至少10GB可用空间

### 快速安装（已部署完成）
项目已部署在您的VPS上：
```bash
服务器: 34.130.54.70
用户: trader
路径: /home/trader/nof1-tracker
```

### 连接到服务器
```bash
# 使用trader用户连接
ssh trader@34.130.54.70

# 或使用root用户连接
ssh root@34.130.54.70  # 密码: 12345ssdlh
```

---

## ⚙️ 环境变量配置

### 1. 编辑配置文件
```bash
cd /home/trader/nof1-tracker
nano .env
```

### 2. 必需配置项

#### 币安API配置（必需）
```bash
# 币安API密钥（必须配置）
BINANCE_API_KEY=your_binance_api_key_here
BINANCE_API_SECRET=your_binance_api_secret_here

# 环境选择
BINANCE_TESTNET=true   # true=测试网, false=正式网
```

#### 交易配置
```bash
# 最大仓位大小（USDT）
MAX_POSITION_SIZE=1000

# 默认杠杆倍数（1-125）
DEFAULT_LEVERAGE=10

# 风险百分比（账户总资金的百分比）
RISK_PERCENTAGE=2.0
```

#### 高级配置
```bash
# NOF1 API基础URL
NOF1_API_BASE_URL=https://nof1.ai/api

# 日志级别
LOG_LEVEL=INFO  # ERROR, WARN, INFO, DEBUG, VERBOSE
```

### 3. 获取币安API密钥

#### 步骤说明：
1. **访问币安官网** - https://www.binance.com
2. **登录账户** - 登录您的币安账户
3. **API管理** - 用户中心 → API管理
4. **创建API** - 点击"创建API"
5. **设置权限** - ⚠️ **重要：必须启用"期货交易"权限**
6. **IP白名单** - 添加您的VPS IP: `34.130.54.70`

#### 安全建议：
- ✅ 启用期货交易权限
- ❌ 禁用提现权限
- ❌ 禁用现货交易权限（可选）
- ✅ 设置IP白名单
- ✅ 使用专用API密钥

---

## 📖 命令使用指南

### 基础命令结构
```bash
node dist/index.js <command> [options]
```

### 1. 🤖 查看可用AI代理

#### 命令
```bash
node dist/index.js agents
```

#### 示例输出
```
🤖 Available AI Agents:
====================
📊 gpt-5 - Status: active
📊 gemini-2.5-pro - Status: active
📊 deepseek-chat-v3.1 - Status: active (有实盘跟踪面板)
📊 claude-sonnet-4-5 - Status: active
📊 buynhold_btc - Status: active
📊 grok-4 - Status: active
📊 qwen3-max - Status: active
```

### 2. 🎯 跟单交易

#### 基础跟单
```bash
# 跟踪指定AI代理
node dist/index.js follow deepseek-chat-v3.1
```

#### 高级跟单选项
```bash
# 仅风险评估，不执行交易
node dist/index.js follow deepseek-chat-v3.1 --risk-only

# 设置轮询间隔（秒）
node dist/index.js follow deepseek-chat-v3.1 --interval 30

# 设置价格容忍度（百分比）
node dist/index.js follow deepseek-chat-v3.1 --price-tolerance 1.5

# 设置总保证金
node dist/index.js follow deepseek-chat-v3.1 --total-margin 50
```

#### 参数详解
| 参数 | 说明 | 默认值 | 示例 |
|------|------|--------|------|
| `--risk-only` | 仅进行风险评估，不执行实际交易 | false | `--risk-only` |
| `--interval` | 轮询间隔（秒） | 30 | `--interval 60` |
| `--price-tolerance` | 价格容忍度（%） | 1.0 | `--price-tolerance 2.0` |
| `--total-margin` | 总保证金（USDT） | 10 | `--total-margin 100` |

### 3. 📊 盈亏分析

#### 基础盈亏查询
```bash
# 查看所有盈亏统计
node dist/index.js profit
```

#### 时间过滤
```bash
# 查看最近7天
node dist/index.js profit --since 7d

# 查看最近30天
node dist/index.js profit --since 30d

# 查看指定日期以来
node dist/index.js profit --since 2024-01-01

# 查看指定时间戳以来
node dist/index.js profit --since 1704067200000
```

#### 交易对过滤
```bash
# 查看特定交易对
node dist/index.js profit --pair BTCUSDT

# 按交易对分组显示
node dist/index.js profit --group-by symbol
```

#### 输出格式
```bash
# 表格格式（默认）
node dist/index.js profit --format table

# JSON格式
node dist/index.js profit --format json
```

#### 盈亏类型选择
```bash
# 仅显示未实现盈亏（当前持仓）
node dist/index.js profit --unrealized-only

# 排除未实现盈亏
node dist/index.js profit --exclude-unrealized

# 强制刷新数据
node dist/index.js profit --refresh
```

#### 组合使用示例
```bash
# 查看最近7天BTCUSDT的详细盈亏，JSON格式输出
node dist/index.js profit --since 7d --pair BTCUSDT --format json

# 查看最近30天按交易对分组的盈亏，排除未实现盈亏
node dist/index.js profit --since 30d --group-by symbol --exclude-unrealized
```

### 4. 📋 系统状态检查

#### 命令
```bash
node dist/index.js status
```

#### 示例输出
```
🔍 System Status Check
======================
✅ Node.js Version: v18.20.8
✅ Environment Variables:
   BINANCE_API_KEY: ****configured****
   BINANCE_API_SECRET: ****configured****
   BINANCE_TESTNET: true
✅ Configuration:
   Max Position Size: 1000 USDT
   Default Leverage: 10x
   Risk Percentage: 2.0%
✅ Binance API Connection: OK
✅ NOF1 API Connection: OK
```

---

## 🔧 高级功能

### 1. PM2 进程管理

#### 查看服务状态
```bash
pm2 status
```

#### 启动/停止/重启服务
```bash
# 启动服务
pm2 start ecosystem.config.js

# 停止服务
pm2 stop nof1-tracker

# 重启服务
pm2 restart nof1-tracker

# 删除服务
pm2 delete nof1-tracker
```

#### 查看实时日志
```bash
# 查看实时日志
pm2 logs nof1-tracker

# 查看最近50行日志
pm2 logs nof1-tracker --lines 50

# 不跟踪新日志
pm2 logs nof1-tracker --nostream
```

#### 监控资源使用
```bash
# 查看详细监控信息
pm2 monit

# 查看内存和CPU使用
pm2 show nof1-tracker
```

### 2. 配置文件管理

#### 主配置文件
```bash
# 查看当前配置
cat .env

# 编辑配置
nano .env

# 备份配置
cp .env .env.backup.$(date +%Y%m%d)
```

#### PM2配置文件
```bash
# 查看PM2配置
cat ecosystem.config.js

# 编辑PM2配置
nano ecosystem.config.js
```

### 3. 日志管理

#### 日志文件位置
```bash
./logs/combined.log    # 综合日志
./logs/out.log         # 标准输出日志
./logs/error.log       # 错误日志
./logs/monitor.log     # 监控日志
```

#### 查看日志
```bash
# 查看最新日志
tail -f ./logs/combined.log

# 查看错误日志
tail -50 ./logs/error.log

# 查看特定时间段日志
grep "2024-10-26" ./logs/combined.log
```

#### 日志清理
```bash
# 清理旧日志（保留最近7天）
find ./logs -name "*.log" -mtime +7 -delete

# 轮转日志
logrotate -f /etc/logrotate.conf
```

---

## 📊 监控与维护

### 1. 服务监控

#### 健康检查脚本
```bash
#!/bin/bash
# health_check.sh

echo "=== NOF1-TRACKER 健康检查 ==="
echo "时间: $(date)"

# 检查PM2状态
echo "📊 PM2状态:"
pm2 status | grep nof1-tracker

# 检查系统资源
echo "💾 内存使用:"
free -h | grep Mem

echo "💽 磁盘使用:"
df -h / | tail -1

# 检查网络连接
echo "🌐 网络连接:"
ping -c 1 api.binance.com >/dev/null && echo "✅ 币安API连通" || echo "❌ 币安API不通"
ping -c 1 nof1.ai >/dev/null && echo "✅ NOF1 API连通" || echo "❌ NOF1 API不通"

# 检查最近错误
echo "❌ 最近错误（最后5条）:"
tail -5 ./logs/error.log 2>/dev/null || echo "无错误日志"
```

#### 自动化监控设置
```bash
# 添加定时监控任务
crontab -e

# 每小时执行健康检查
0 * * * * cd /home/trader/nof1-tracker && ./health_check.sh >> ./logs/health.log

# 每天凌晨清理日志
0 2 * * * cd /home/trader/nof1-tracker && find ./logs -name "*.log" -mtime +7 -delete
```

### 2. 性能优化

#### 内存使用优化
```bash
# 查看内存使用
pm2 show nof1-tracker

# 设置内存限制（在ecosystem.config.js中）
max_memory_restart: '500M'

# 重启释放内存
pm2 restart nof1-tracker
```

#### 网络优化
```bash
# 检查网络延迟
ping -c 10 fapi.binance.com

# 测试API响应时间
curl -w "Total time: %{time_total}s\n" -o /dev/null -s https://fapi.binance.com/fapi/v1/time
```

### 3. 数据备份

#### 自动备份脚本
```bash
#!/bin/bash
# backup.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/home/trader/backups"
mkdir -p $BACKUP_DIR

# 备份配置文件
cp .env $BACKUP_DIR/env_$DATE
cp ecosystem.config.js $BACKUP_DIR/ecosystem_$DATE.js

# 备份数据目录
if [ -d "./data" ]; then
    tar -czf $BACKUP_DIR/data_$DATE.tar.gz ./data
fi

# 备份日志（最近7天）
find ./logs -name "*.log" -mtime -7 | tar -czf $BACKUP_DIR/logs_$DATE.tar.gz -T -

# 清理30天前的备份
find $BACKUP_DIR -name "*" -mtime +30 -delete

echo "$(date): Backup completed - $DATE" >> ./logs/backup.log
```

---

## 🔐 安全注意事项

### 1. API密钥安全

#### 基本安全原则
- ✅ **使用专用API密钥** - 仅用于此项目
- ✅ **启用IP白名单** - 限制访问IP
- ✅ **最小权限原则** - 仅启用必要权限
- ✅ **定期轮换密钥** - 建议每月更换
- ❌ **禁用提现权限** - 永远不要启用
- ❌ **避免硬编码** - 使用环境变量

#### 权限设置建议
```
✅ 启用权限:
- 期货交易
- 读取

❌ 禁用权限:
- 提现
- 现货交易（可选）
- 合约代理（可选）
```

### 2. 服务器安全

#### 基础安全配置
```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 配置防火墙
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 22

# 检查安全状态
sudo ufw status
```

#### SSH安全
```bash
# 禁用root密码登录（建议）
sudo nano /etc/ssh/sshd_config
# 设置: PasswordAuthentication no
# 设置: PermitRootLogin no

# 重启SSH服务
sudo systemctl restart sshd
```

### 3. 风险控制

#### 交易风险控制
```bash
# 保守的风险参数建议
RISK_PERCENTAGE=1.0         # 1% 风险比例
DEFAULT_LEVERAGE=5          # 5倍杠杆
MAX_POSITION_SIZE=100       # 100 USDT最大仓位
```

#### 测试网使用
```bash
# 首次使用务必设置测试网
BINANCE_TESTNET=true

# 测试网API端点
# https://testnet.binancefuture.com
```

---

## 🔧 故障排除

### 1. 常见错误及解决方案

#### API密钥错误
```
错误: API-key format invalid
解决: 检查BINANCE_API_KEY和BINANCE_API_SECRET是否正确配置
```

#### 权限错误
```
错误: This request is not supported in sandbox mode
解决: 检查是否在测试网模式，测试网不支持某些功能
```

#### 网络连接错误
```
错误: ECONNREFUSED 或 socket hang up
解决: 检查网络连接，可能是API服务器临时不可用
```

#### 时间同步错误
```
错误: Timestamp for this request is outside of the recvWindow
解决: 系统会自动同步时间，如持续出现可手动同步
```

### 2. 调试步骤

#### 启用详细日志
```bash
# 编辑配置文件
nano .env

# 设置调试级别
LOG_LEVEL=DEBUG

# 重启服务
pm2 restart nof1-tracker

# 查看详细日志
pm2 logs nof1-tracker
```

#### 手动测试
```bash
# 测试系统状态
node dist/index.js status

# 测试API连接
node dist/index.js agents

# 测试盈亏分析（需要有效API密钥）
node dist/index.js profit
```

#### 网络诊断
```bash
# 测试币安API连通性
curl https://fapi.binance.com/fapi/v1/time

# 测试NOF1 API连通性
curl https://nof1.ai/api/account-totals?lastHourlyMarker=1
```

### 3. 性能问题

#### 内存泄漏
```bash
# 监控内存使用
pm2 monit

# 如果内存持续增长，重启服务
pm2 restart nof1-tracker
```

#### CPU使用过高
```bash
# 检查CPU使用
top -p $(pgrep -f nof1-tracker)

# 增加轮询间隔减少CPU使用
node dist/index.js follow deepseek-chat-v3.1 --interval 60
```

---

## 💡 最佳实践

### 1. 新用户使用流程

#### 第一步：测试网验证
```bash
# 1. 设置测试网模式
echo "BINANCE_TESTNET=true" >> .env

# 2. 配置测试网API密钥
# 获取地址: https://testnet.binancefuture.com/

# 3. 启动风险评估模式
node dist/index.js follow deepseek-chat-v3.1 --risk-only

# 4. 观察1-2天，确保系统稳定
```

#### 第二步：小额实盘
```bash
# 1. 切换到正式网
echo "BINANCE_TESTNET=false" >> .env

# 2. 设置保守参数
echo "MAX_POSITION_SIZE=50" >> .env
echo "DEFAULT_LEVERAGE=3" >> .env
echo "RISK_PERCENTAGE=0.5" >> .env

# 3. 启动跟单
pm2 restart nof1-tracker
```

#### 第三步：逐步优化
```bash
# 根据实际情况调整参数
# 观察盈亏报告
node dist/index.js profit --since 7d

# 根据表现调整风险参数
```

### 2. 日常运维建议

#### 每日检查
```bash
# 查看服务状态
pm2 status

# 查看当日盈亏
node dist/index.js profit --since 1d

# 检查错误日志
tail -20 ./logs/error.log
```

#### 每周维护
```bash
# 查看周度盈亏报告
node dist/index.js profit --since 7d --group-by symbol

# 备份重要数据
./backup.sh

# 检查系统资源
df -h && free -h
```

#### 每月审查
```bash
# 全面盈亏分析
node dist/index.js profit --since 30d --format json > monthly_report.json

# 更新API密钥（建议）
# 检查系统更新
sudo apt update && sudo apt list --upgradable
```

### 3. 参数调优建议

#### 根据风险偏好调整
```bash
# 保守型用户
RISK_PERCENTAGE=0.5
DEFAULT_LEVERAGE=3
MAX_POSITION_SIZE=50

# 平衡型用户
RISK_PERCENTAGE=1.0
DEFAULT_LEVERAGE=5
MAX_POSITION_SIZE=200

# 激进型用户
RISK_PERCENTAGE=2.0
DEFAULT_LEVERAGE=10
MAX_POSITION_SIZE=500
```

#### 根据资金规模调整
```bash
# 小资金账户（<1000 USDT）
MAX_POSITION_SIZE=50
RISK_PERCENTAGE=1.0

# 中等资金账户（1000-10000 USDT）
MAX_POSITION_SIZE=200
RISK_PERCENTAGE=1.5

# 大资金账户（>10000 USDT）
MAX_POSITION_SIZE=1000
RISK_PERCENTAGE=2.0
```

---

## 📞 技术支持

### 获取帮助
- **项目文档**: [README.md](./README.md)
- **GitHub Issues**: https://github.com/terryso/nof1-tracker/issues
- **实盘跟踪面板**: https://nof1-tracker-dashboard.onrender.com

### 贡献代码
- **Fork项目**: 在GitHub上Fork项目
- **提交PR**: 提交Pull Request
- **报告Bug**: 在Issues中报告问题

---

*最后更新时间: 2025-10-26*

**⚠️ 免责声明**: 加密货币交易存在高风险，请谨慎使用此工具。建议在充分了解风险的前提下，从小额资金开始测试。作者不对任何交易损失承担责任。